!function(e,r,n){"use strict";var u=function(){return(u=Object.assign||function(e){for(var r,n=1,u=arguments.length;n<u;n++)for(var t in r=arguments[n])Object.prototype.hasOwnProperty.call(r,t)&&(e[t]=r[t]);return e}).apply(this,arguments)},t=function(e,r,n,t){if(e.exists){var o,a,i=e.val();return function(e){return null!=e&&"object"==typeof e&&!1===Array.isArray(e)}(i)?u({},t?t(i):i,r?((o={})[r]=e.key,o):null,n?((a={})[n]=e.ref,a):null):t?t(i):i}},o={loading:!0,value:{keys:[],values:[]}},a=function(e,r){switch(r.type){case"add":return r.snapshot?u({},e,{error:void 0,value:s(e.value,r.snapshot,r.previousKey)}):e;case"change":return r.snapshot?u({},e,{error:void 0,value:c(e.value,r.snapshot)}):e;case"error":return u({},e,{error:r.error,loading:!1,value:{keys:void 0,values:void 0}});case"move":return r.snapshot?u({},e,{error:void 0,value:v(e.value,r.snapshot,r.previousKey)}):e;case"remove":return r.snapshot?u({},e,{error:void 0,value:l(e.value,r.snapshot)}):e;case"reset":return o;case"value":return u({},e,{error:void 0,loading:!1,value:i(r.snapshots)});case"empty":return u({},e,{loading:!1,value:{keys:void 0,values:void 0}});default:return e}},i=function(e){if(!e)return{keys:[],values:[]};var r=[],n=[];return e.forEach(function(e){e.key&&(r.push(e.key),n.push(e))}),{keys:r,values:n}},s=function(e,r,n){if(!r.key)return e;var u=e.keys,t=e.values;if(!n)return{keys:u?[r.key].concat(u):[r.key],values:t?[r].concat(t):[r]};var o=u?u.indexOf(n):0;return{keys:u?u.slice(0,o+1).concat([r.key],u.slice(o+1)):[r.key],values:t?t.slice(0,o+1).concat([r],t.slice(o+1)):[r]}},c=function(e,r){if(!r.key)return e;var n=e.keys,t=e.values,o=n?n.indexOf(r.key):0;return u({},e,{values:t?t.slice(0,o).concat([r],t.slice(o+1)):[r]})},l=function(e,r){if(!r.key)return e;var n=e.keys,u=e.values,t=n?n.indexOf(r.key):0;return{keys:n?n.slice(0,t).concat(n.slice(t+1)):[],values:u?u.slice(0,t).concat(u.slice(t+1)):[]}},v=function(e,r,n){var u=l(e,r);return s(u,r,n)},f=function(e){return{loading:void 0===e||null===e,value:e}},d=function(e){var n=e?e():void 0,t=r.useReducer(function(e,r){switch(r.type){case"error":return u({},e,{error:r.error,loading:!1,value:void 0});case"reset":return f(r.defaultValue);case"value":return u({},e,{error:void 0,loading:!1,value:r.value});default:return e}},f(n)),o=t[0],a=t[1],i=function(){var r=e?e():void 0;a({type:"reset",defaultValue:r})},s=function(e){a({type:"error",error:e})},c=function(e){a({type:"value",value:e})};return r.useMemo(function(){return{error:o.error,loading:o.loading,reset:i,setError:s,setValue:c,value:o.value}},[o.error,o.loading,i,s,c,o.value])},y=function(e,r){var n=!e&&!r,u=!!e&&!!r&&e.isEqual(r);return n||u},p=function(e,n){return function(e,n,u){var t=r.useRef(e);return r.useEffect(function(){n(e,t.current)||(t.current=e,u&&u())}),t}(e,y,n)},h=function(e){var u=r.useReducer(a,o),t=u[0],i=u[1],s=p(e,function(){return i({type:"reset"})}).current;r.useEffect(function(){if(s){var e,r=function(e,r){i({type:"add",previousKey:r,snapshot:e})},u=function(e){i({type:"error",error:e})},t=function(e){i({type:"value",snapshots:e})};n.onValue(s,function(o){var a=o.val()?Object.keys(o.val()).length:0;if(0===a)e=n.onChildAdded(s,r,u),t([]);else{var i=[];e=n.onChildAdded(s,function(e,n){if(a>0)return a--,i.push(e),void(0===a&&t(i));r(e,n)},u)}},u,{onlyOnce:!0});var o=n.onChildChanged(s,function(e){i({type:"change",snapshot:e})},u),a=n.onChildMoved(s,function(e,r){i({type:"move",previousKey:r,snapshot:e})},u),c=n.onChildRemoved(s,function(e){i({type:"remove",snapshot:e})},u);return function(){n.off(s,"child_added",e),n.off(s,"child_changed",o),n.off(s,"child_moved",a),n.off(s,"child_removed",c)}}i({type:"empty"})},[i,s]);var c=[t.value.values,t.loading,t.error];return r.useMemo(function(){return c},c)},k=function(e){var u=d(),t=u.error,o=u.loading,a=u.reset,i=u.setError,s=u.setValue,c=u.value,l=p(e,a);r.useEffect(function(){var e=l.current;if(e)return n.onValue(e,s,i),function(){n.off(e,"value",s)};s(void 0)},[l.current]);var v=[c,o,t];return r.useMemo(function(){return v},v)};e.useList=h,e.useListKeys=function(e){var n=h(e),u=n[0],t=n[1],o=n[2],a=[r.useMemo(function(){return u?u.map(function(e){return e.key}):void 0},[u]),t,o];return r.useMemo(function(){return a},a)},e.useListVals=function(e,n){var u=n?n.keyField:void 0,o=n?n.refField:void 0,a=n?n.transform:void 0,i=h(e),s=i[0],c=i[1],l=i[2],v=[r.useMemo(function(){return s?s.map(function(e){return t(e,u,o,a)}):void 0},[s,u,o,a]),c,l];return r.useMemo(function(){return v},v)},e.useObject=k,e.useObjectVal=function(e,n){var u=n?n.keyField:void 0,o=n?n.refField:void 0,a=n?n.transform:void 0,i=k(e),s=i[0],c=i[1],l=i[2],v=[r.useMemo(function(){return s?t(s,u,o,a):void 0},[s,u,o,a]),c,l];return r.useMemo(function(){return v},v)}}(this["react-firebase-hooks"]=this["react-firebase-hooks"]||{},react,database);
//# sourceMappingURL=react-firebase-hooks-database.js.map
